name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  SOURCE_DIR:   ${{ github.workspace }}/GUITesting
  QT_VERSION:   5.15.2

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Install Qt
      uses: jurplel/install-qt-action@v3
      with:
        version:      ${{ env.QT_VERSION }}
        host:         linux
        target:       desktop
        arch:         gcc_64
        dir:          ${{ runner.temp }}
        setup-python: false
    - name: initial qmake command
      run: |
        ls ${{ github.workspace }}
        cd ${{ env.SOURCE_DIR }}
        qmake -project
    - name: append QT += gui widgets to GUITesting.pro
      uses: DamianReeves/write-file-action@master
      with:
        path: ${{ env.SOURCE_DIR }}/GUITesting.pro
        contents: |
          QT += gui widgets
        write-mode: append
    - name: 2nd qmake step
      run: |
        cd ${{ env.SOURCE_DIR }}
        qmake GUITesting.pro
    - name: make
      run: |
        cd ${{ env.SOURCE_DIR }}
        make
